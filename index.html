<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, viewport-fit=cover"
  >
  <title>PB Tools</title>

  <!-- Security-related meta -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta
    http-equiv="Content-Security-Policy"
    content="
      default-src 'self';
      script-src 'self';
      style-src 'self' 'unsafe-inline';
      img-src 'self' data:;
      connect-src 'self';
      font-src 'self';
      object-src 'none';
      base-uri 'self';
      form-action 'self';
      frame-ancestors 'none';
    "
  >

  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo-circle">P</div>
        <div class="sidebar-title">
          <div class="app-name">PB Tools</div>
          <div class="app-subtitle">Internal tools</div>
        </div>
        <button
          class="sidebar-toggle"
          id="sidebarToggleButton"
          aria-label="Toggle sidebar"
        >
          ‚Äπ
        </button>
      </div>

      <nav class="sidebar-nav">
        <button
          class="nav-item active"
          data-module="csvWorkbench"
        >
          <span class="nav-icon">üìä</span>
          <span class="nav-label">CSV Workbench</span>
        </button>

        <button
          class="nav-item"
          data-module="reportBuilder"

        >
          <span class="nav-icon">üìÑ</span>
          <span class="nav-label">Report Builder</span>
        </button>

        <button
          class="nav-item"
          data-module="emailTemplater"
        >
          <span class="nav-icon">‚úâÔ∏è</span>
          <span class="nav-label">Email Templater</span>
        </button>

        <button
          class="nav-item"
          data-module="hashGenerator"
        >
          <span class="nav-icon">üîê</span>
          <span class="nav-label">Hash Generator</span>
        </button>

        <button
          class="nav-item"
          data-module="emlAnalyzer"
        >
          <span class="nav-icon">üìß</span>
          <span class="nav-label">EML Analyzer</span>
        </button>

        <button
          class="nav-item"
          data-module="settings"
        >
          <span class="nav-icon">‚öôÔ∏è</span>
          <span class="nav-label">Settings</span>
        </button>
      </nav>

      <div class="sidebar-footer">
        <span class="env-badge">Local only</span>
        <span class="version-badge">v0.2.0</span>
      </div>
    </aside>

    <!-- Main content -->
    <main class="main">
      <header class="main-header">
        <div>
          <h1 id="moduleTitle">CSV / Spreadsheet Workbench</h1>
          <p id="moduleSubtitle" class="main-subtitle">
            Load, clean, and export campaign and PB Tools CSV data. All processing happens locally.
          </p>
        </div>

        <div class="main-actions">
          <span class="status-dot status-ok"></span>
          <span class="status-label">Ready</span>
        </div>
      </header>

      <section id="moduleContainer" class="module-container">
        <!-- The active module will render its UI here -->
      </section>
    </main>
  </div>

  <!-- Export modal (for CSV Workbench) -->
  <div id="exportModalBackdrop" class="modal-backdrop hidden">
    <div class="modal">
      <div class="modal-header">
        <div>
          <div class="modal-title">Export data</div>
          <div class="modal-subtitle">
            Choose what to export and in which format.
          </div>
        </div>
        <button
          class="modal-close"
          id="exportModalCloseBtn"
          aria-label="Close export dialog"
        >
          √ó
        </button>
      </div>

      <div class="modal-body">
        <div class="modal-section-title">Format</div>
        <div class="export-format-row">
          <label class="export-format-card">
            <input type="radio" name="exportFormat" value="csv" checked>
            <div class="export-format-content">
              <div class="export-format-title">CSV</div>
              <div class="export-format-subtitle">
                Download as CSV for Excel or other tools.
              </div>
            </div>
          </label>

          <label class="export-format-card">
            <input type="radio" name="exportFormat" value="xlsx">
            <div class="export-format-content">
              <div class="export-format-title">XLSX</div>
              <div class="export-format-subtitle">
                Excel workbook.
              </div>
            </div>
          </label>
        </div>

        <div class="modal-section-title" style="margin-top:0.75rem;">Dataset</div>
        <div class="export-dataset-row">
          <label class="export-dataset-card">
            <input type="radio" name="exportDataset" value="main" checked>
            <div class="export-format-content">
              <div class="export-format-title">Main data</div>
              <div class="export-format-subtitle">
                Current table with visible columns and annotations.
              </div>
            </div>
          </label>

          <label class="export-dataset-card" id="exportSummaryOption">
            <input type="radio" name="exportDataset" value="summary">
            <div class="export-format-content">
              <div class="export-format-title">Summary</div>
              <div class="export-format-subtitle">
                Latest group &amp; count results (if available).
              </div>
            </div>
          </label>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" id="exportCancelButton">
          Cancel
        </button>
        <button class="btn" id="exportConfirmButton">
          Export
        </button>
      </div>
    </div>
  </div>

  <!-- Libraries (local) -->
  <script src="lib/papaparse.min.js"></script>
  <script src="lib/xlsx.full.min.js"></script>
  <script src="lib/chart.umd.js"></script>

  <!-- Core app + modules -->
  <script src="app.js"></script>
  <script src="modules/csvWorkbench.js"></script>
  <script src="modules/reportBuilder.js"></script> 
  <script src="modules/emailTemplater.js"></script>
  <script src="modules/hashGenerator.js"></script>
  <script src="modules/emlAnalyzer.js"></script>
  <script src="modules/settings.js"></script>
</body>
</html>